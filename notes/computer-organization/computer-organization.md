---
title: Computer Organization
---

# Computer Organization

## 概论
### 主机基本结构
```
主 机
  ├─ 运算器
  │    ├─ ALU 算术逻辑单元
  │    ├─ ACC 累加器
  │    ├─ MQ  乘商寄存器
  │    └─ X   操作数寄存器
  │
  ├─ 控制器
  │    ├─ CU 控制单元
  │    ├─ IR 指令寄存器
  │    └─ PC 程序计数器
  │
  └─ 存储器
       ├─ 存储体
       ├─ MAR 存储地址寄存器
       └─ MDR 存储数据缓冲寄存器
```
### 运算器

| | ACC | MQ | X
:---:|:---:|:---:|:---:
加 | 被加数，和 || 加数
减 | 被减数，差 || 减数
乘 | 积高位 | 乘数，积低位 | 被乘数
除 | 被除数，余数 | 商 | 除数

乘法运算原理：在计算机中，数以二进制表示，所以竖式斜式的一行中要么是被乘数，要么全为 0，故乘法通过移位累加来实现。除法则是通过移位减法。

### 指令执行过程
处理一条指令的过程分为三个阶段：**取指令**、**分析指令**和**执行指令**
* 取指令：PC 存放当前指令地址并计数 (PC)+1 -> PC
* 分析指令：从主存中取出指令到 IR 中
* 执行指令：在 CU 的控制下执行指令

例：取数指令的执行：

$$
\text{PC}\xrightarrow{\text{instr. addr.}}\text{MAR}\xrightarrow{\text{instr. addr.}}\text{Memory}\xrightarrow{\text{instr.}}\text{MDR}\xrightarrow{\text{instr.}}\text{IR}\xrightarrow{}\\
\vphantom{ }\\
\xrightarrow{\text{instr.}}\text{CU}\xrightarrow{\text{instr.}}
\begin{cases}
\xrightarrow{\text{opration}}\text{CU}\searrow^{\text{(control)}}\\
\xrightarrow{\text{opnd. addr.}}\text{MAR}\xrightarrow{\text{opnd. addr.}}\text{Memory}\xrightarrow{\text{opnd.}}\text{MDR}\xrightarrow{\text{opnd.}}\text{ACC}\\
\end{cases}
$$


### 计算机性能指标
#### 机器字长

CPU一次处理的位数。  
比如一次运算为 $8\text{bit}+8\text{bit}\rightarrow 8\text{bit}$，则机器字长为 8 位。  
在这个模型机的假设中，机器字长和寄存器（ACC、MQ、X）位数以及存储字长相等。  

#### 运算速度
有不同的测量方法：
+ 主频，还要考虑核数和每核线程数
+ 吉普森法，即指令执行时间的加权平均
+ CPI, Clock cycle Per Instruction
+ IPC
+ MIPS, Million Instructions Per Second
+ (M)FLOPS，每秒浮点运算（百万）次数

#### 存储容量
主存：单元个数$\times$存储字长，字节数  
辅存：字节数

## 系统总线
总线分为：
* 片内总线：芯片内部的总线
* 系统总线：机器内芯片间的总线
* 通信总线：计算机系统总线或者计算机系统和其它系统之间的通信

系统总线分类：
* 数据总线：双向 位数一般小于等于机器字长和存储字长
* 地址总线：单向 与存储地址和 I/O 地址有关
* 控制总线：有出有入

### 总线性能指标
* 总线宽度：数据线根数
* 标准传输率： 每秒传输的最大字节数（MBps）
* 时钟同步/异步
* 总线复用：减少信号线数量，减少管脚，提高集成度
* 信号线数：地址、数据和控制线的总和
* 总线控制方式
* 其它

### 总线结构

（见教材）

### 总线控制

#### 总线判优控制

* 集中式
  * 链式查询：$\mathrm{BS}$、$\mathrm{BG}$、$\mathrm{BR}$
  * 计数器定时查询：$\mathrm{BS}$、$\mathrm{BR}$、设备地址、计数器
  * 独立请求方式：$\mathrm{BG_n}$、$\mathrm{BR_n}$
* 分布式


#### 总线通信控制

* 同步：统一时钟，同步时序
* 异步：请求—回答；不互锁、半互锁、全互锁
* 半同步：发送在 $\text{CLK}$ 前沿，接受在 $\text{CLK}$ 后沿；$\overline{\text{WAIT}}$ 信号
* 分离：主模块请求后放弃控制权


## 存储器

### 分类
按存取方式：
* 随机访问：存取时间与物理地址无关
  * 随机存储器 RAM
  * 只读存储器 ROM
* 串行访问：存取时间与物理地址有关
  * 顺序存取存储器 eg. 磁带
  * 直接存取存储器 eg. 机械硬盘

注：机械硬盘的访问方式是先直接找到磁道，然后再顺序寻访到指定位置。

### 主存

#### 主存技术指标
* 容量
* 速度
  * 存取时间：访问时间（读出时间、写入时间）
  * 存取周期：连续两次独立存储器操作所需最小间隔
* 带宽（位/秒）

#### 地址分配

* 大端方式：高位字节存低位地址，作为字地址  
* 小端方式：低位字节存低位地址，作为字地址（8086）

#### 半导体芯片
控制线：
* 片选：$\overline{\text{CS}}$（Chip Select）、$\overline{\text{CE}}$（Chip Enable）
* 读/写：
  * $\overline{\text{WE}}$ 低电平写，高电平读
  * $\overline{\text{OE}}$（Output Enable）允许读、$\overline{\text{WE}}$（Write Enable）允许写

译码驱动：
* 线选法：字线、位线
* 重合法：行地址、列地址

#### RAM

##### SRAM
基于触发器原理  
基本单元电路  
Intel 2114：列分组  

##### DRAM
基于电容原理  
基本单元电路：三管、单管  
Intel 1103、Intel 4116

4116 的读写比较特殊，有跷跷板电路

DRAM 刷新  
每次刷新的是一行的存储单元，只和行地址有关
* 集中刷新 每个刷新周期内，集中一个时间刷新，此时间成为死区，DRAM 无法通信
* 分散刷新 每一个存取周期刷新一次，没有死区但是性能下降
* 异步刷新 每一段集中刷新一次，可以安排在译码阶段

|  | DRAM | SRAM
:-: | :-: | :-:
存储原理 | 电容 | 触发器
集成度 | 高 | 低
功耗 | 小 | 大
价格 | 低 | 高
速度 | 慢 | 快
刷新 | 有 | 无

内存条用 DRAM，高速缓存用 SRAM。

#### 存储器容量扩展

* 位扩展 增加存储字长 地址线一样，接不同数据线，共用片选、读写线，同时工作
* 字扩展 增加存储字的总数 低位地址线一样，最高（几）位地址线（译码后）接片选，使得不同时工作，接相同数据线
* 字-位扩展 分组

#### CPU 与存储器的连接

$\mathrm{\overline{MREQ}}$ Memory Request 访存信号  

### 提高访存速度的措施

#### 单体多字系统
在存储器和寄存器之间增加多字寄存器  
增加存储器带宽

#### 多体并行系统
##### 高位交叉  
##### 低位交叉

$N$ 体的地位交叉存储器连续读取 $N$ 个字，若存取周期为 $T$，总线传输周期为 $\tau$，则有 $T=N\tau$。连续读取 $N$ 个字所需的时间为 $T+(N-1)\tau$。

#### 高性能存储芯片

* SDRAM 同步 DRAM
  * 在系统时钟的控制下读写，CPU无需等待
* RDRAM
* CDRAM 带 Cache 的 DRAM

### 高速缓冲存储器

程序访问的局部性原理：当前正在使用的指令和数据和在空间上相邻的指令和数据在不久的将来还会被使用。

主存和缓存按块存储，块的大小相同，所以主存和缓存的块内地址完全一样。

##### 命中率
命中率和 Cache 的容量和块长有关，一般每块取 4 到 8 个字。

##### Cache-主存的效率

##### Cache 的基本结构

#### Cache-主存地址映射

在组相联映射中，若把 Cache 当中所有的块都分成一组，那么就退化成全相联映射；如果每一组只有唯一的一块，那么就退化成直接相联。

靠近 CPU 的缓存要求速度高，采用直接相联或者路数比较少的组相联。中间的层次采用组相联，距离 CPU 最远的层次采用全相联。

#### 替换算法
* 先进先出算法 FIFO
* 近期最少使用算法 LRU

### 辅助存储器

盘面-磁道-存储单元

磁道组成同心圆，外部同心圆位密度低。

## 输入输出系统

### I/O 接口

接口的功能和组成：
* 选址，设备选择电路
* 传送命令与数据，命令寄存器、命令译码器、数据缓冲寄存器
* 反映设备状态，状态标记触发器：完成触发器 D、工作触发器 B、中断请求触发器 INTR、屏蔽触发器 MASK
* 串并转换、电平转换

接口类型：
* 串行接口、并行接口  
* 可编程接口、不可编程接口
* 通用接口、专用接口
* 中断接口、DMA 接口

### 程序查询方式

### 程序中断方式

中断服务程序的流程
* 保护现场
  * 程序断点，寄存器内容
* 中断服务
* 恢复现场

### DMA 方式

## 计算方法

### 数据表示

#### 无符号数
只有数值部分，长度和寄存器长度有关。如 8 位寄存器能存储 0~255 的数。

#### 有符号数
##### 原码
原码实际上是带符号的绝对值表示。

注意原码中有正负 0 之分。

##### 补码
找到一个与负数等价的正数，使得加减法归一化。

+9 是 -3 以 12 为模的补数。即 $-3\equiv +9 \ \ (\text{mod } 12)$。

一个负数与其补数的绝对值之和即为模值。

正数的补数就是本身。为了区别正负，一个n位数的补数规定以 $2^{n+1}$ 为模，这样负数的补数前面自然地添加上了一个 1。

对于小数，使用模为 2 的补数。

##### 反码
反码表示即对负数的原码取反，与负数补码相比，没有加一。相当于模 $2^{n+1}-1$。对于小数，相当于模 $2-2^{-n}$，综合来看，就是少了最低位的权值。

也有正负 0 之分。

##### 移码
移码不区分正负数，定义为 $2^n+x$。以 1 开头表示正数，以0开头表示负数。  
移码和补码只差一个符号位。  
移码没有给出小数的定义，通常用来表示浮点数的阶码。

#### 定点表示

 | | 小数定点机 |整数定点机
--:|--:|--:
表示方式|$S_f\vert.S_1S_2\cdots S_n$|$S_f\vert\ S_1S_2\cdots S_n.$
原码| $-(1-2^{-n})\to+(1-2^{-n})$| $-(2^n-1)\to+(2^n-1)$|
补码| $-1\to+(1-2^{-n})$| $-2^n\to+(2^n-1)$|
反码| $-(1-2^{-n})\to+(1-2^{-n})$| $-(2^n-1)\to+(2^n-1)$|